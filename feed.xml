<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.7">Jekyll</generator><link href="https://wouterj.nl/feed.xml" rel="self" type="application/atom+xml" /><link href="https://wouterj.nl/" rel="alternate" type="text/html" /><updated>2025-12-17T11:08:10+00:00</updated><id>https://wouterj.nl/feed.xml</id><title type="html">Wouter J</title><author><name>Wouter de Jong</name></author><entry><title type="html">Symfony 20 year!</title><link href="https://wouterj.nl/2025/12/symfony-20-year" rel="alternate" type="text/html" title="Symfony 20 year!" /><published>2025-12-17T00:00:00+00:00</published><updated>2025-12-17T00:00:00+00:00</updated><id>https://wouterj.nl/2025/12/symfony-20-year</id><content type="html" xml:base="https://wouterj.nl/2025/12/symfony-20-year"><![CDATA[<p>This year, Symfony <a href="https://symfony.com/20years">celebrates its 20 year anniversary</a>.
Let’s dive into some statistics of years of making web development history.</p>

<aside class="side" data-type="Acknowledgement">
  <p>The graphs and metrics in this post are heavily inspired and based on
<a href="https://curl.se/dashboard.html">Daniel Stenberg’s curl dashboard</a>. If you
enjoy data and open source project, go give that dashboard a visit.</p>
</aside>

<p>This post features graphs, with some annotations of things I remember and
observe in the graphs. If you find any other interesting stuff, please share
it! All data and graphs for this project are on
<a href="https://github.com/wouterj-nl/symfony-stats">GitHub</a>. Some graph are
better viewed in full size, clicking on a graph opens a full size window.</p>

<p>Like many projects at that time, Symfony 1 started with Subversion and a
self-hosted code platform at <a href="https://web.archive.org/web/20100419194120/http://trac.symfony-project.org/report">trac.symfony-project.org</a>.
During the development phase of Symfony 2, the project
<a href="https://symfony.com/blog/symfony-2-migration-to-git">moved to Git</a>. To
keep the scope of all data extraction for this post manageable, I decided to
focus on all statistics starting at Symfony 2.0 and only take the main
mono-repository into account.</p>

<p><a href="/img/sf-stats/release-number.svg" target="_blank">
    <img src="/img/sf-stats/release-number.svg" alt="" class="figure" />
</a></p>

<p>As a start, let’s list all Symfony releases. Today, with 8.0.2 just over a
week old, the project has had 699 <em>stable</em> releases (excluding
alpha/beta/rc).</p>

<p>At first, the releases were done naturally: Patch releases when enough bugs
are fixed, and a minor release when features are stabilized.</p>

<p>In October 2012, Symfony adopted <a href="https://symfony.com/blog/a-new-release-process-for-symfony">a time-based release process</a>
that is familiar to what’s in use today. Symfony started adopting
Semantic Versioning, deprecations and smooth upgrade paths. While gaining
more experience with these new methodologies throughout the 2.x series, the
release cycle <a href="https://symfony.com/blog/symfony-3-0-the-roadmap">changed a couple times</a>.</p>

<p>You can see releases “stacking up” in the graph on the same day, as
multiple minor versions were supported at the same moment. This went as
crazy as supporting Symfony 2.7 (released in 2015 on PHP 5.3.9!), 2.8, 3.4,
4.0 and 4.1 all at the same time in early 2019. After this, you can see the
graph settle at the <a href="https://symfony.com/releases">steady pace we are used to today</a>.</p>

<p>Other statistics in this post are calculated for every “latest” release.
For instance, the data is generated for 4.0.0, 4.0.1, etc. until the
release of 4.1.0, and then continues with 4.1.1, 4.1.2, etc. Eventhough 4.0
and 4.1 were maintained at the same time, we ignore future 4.0 patch
releases.</p>

<p><a href="/img/sf-stats/components-over-time.svg" target="_blank">
    <img src="/img/sf-stats/components-over-time.svg" alt="" class="figure" />
</a></p>

<p>Almost every minor/major Symfony version introduced a new component
(excluding component bridges like Mailer integrations). In fact, the
latest Symfony 7.4/8.0 release is the 3rd release without a new component!</p>

<p>Symfony 2.0 packaged 32 components, almost tripled with 80 components and
<a href="https://symfony.com/stats/downloads">308 total packages in the Symfony 8.0</a>.</p>

<p><a href="/img/sf-stats/merges-over-time.svg" target="_blank">
    <img src="/img/sf-stats/merges-over-time.svg" alt="" class="figure" />
</a></p>

<p>Since the end of 2013, Symfony uses a CLI tool to merge pull request. This
labels every merge as “minor” (important work, but not noteworthy in a
changelog), “bug” (a fixed bug) or “feature” (new features).</p>

<p>Mapping the merges by type for each months gives a mostly chaotic graph.
You can see a big drop in feature merges before the releases in May and
November, especially during the release of a new major every 2 years.
During this period, the community focuses on stabilizing the existing
features and helping the ecosystem with adding support for the new major
version.</p>

<p>And one thing is for sure: Activity hasn’t slowed down after 11 years since
Symfony 2.0!</p>

<h2 id="contributors">Contributors</h2>

<p>So who are these people that make Symfony possible? Let’s take a close look
at some contributor statistics.</p>

<p><a href="/img/sf-stats/authors-per-month.svg" target="_blank">
    <img src="/img/sf-stats/authors-per-month.svg" alt="" class="figure" />
</a></p>

<p>An average of 60 unique authors contribute code to Symfony every month.
Over the years, this number has gone up and down but still is pretty stable
since 2012.</p>

<figure class="figure figure-1-2">
  <p><a href="/img/sf-stats/95-percent.svg" target="_blank">
    <img src="/img/sf-stats/95-percent.svg" alt="" class="" />
</a></p>

  <p><a href="/img/sf-stats/80-percent.svg" target="_blank">
    <img src="/img/sf-stats/80-percent.svg" alt="" class="" />
</a></p>

  <p><a href="/img/sf-stats/50-percent.svg" target="_blank">
    <img src="/img/sf-stats/50-percent.svg" alt="" class="" />
</a></p>

</figure>

<p>In total, 340 individual contributors own 95% of the commits in 2025.
At 6 people are responsible for 50% of the commits for years. This shows
the strength of Symfony and its community: It’s not just a couple of
contributors doing the work but hundreds of people working together to help
everyone move forward!</p>

<p>Interestingly, the peak in 2019-2021 is also visible in
<a href="https://curl.se/dashboard1.html#authors-of-95-percent">the curl project</a>.</p>

<p><a href="/img/sf-stats/firsttimers.svg" target="_blank">
    <img src="/img/sf-stats/firsttimers.svg" alt="" class="figure" />
</a></p>

<p>50% of the commit authors every month are new contributors that didn’t
commit anything to the project before. It’s amazing to me how many new
people keep finding the project and sharing new insights.</p>

<p><a href="/img/sf-stats/author-remains.svg" target="_blank">
    <img src="/img/sf-stats/author-remains.svg" alt="" class="figure" />
</a></p>

<aside class="side" data-type="Accuracy">
  <p>This graph groups lines by commit author email. Of all metadata available
on git commits, the author is email is probably most specific. However,
there are still inaccuracies if for instance people changed their e-mail
address.</p>
</aside>

<p>Of all the new work committed every month, how much individual contributors
own at least 1 line in the current codebase? As it turns out, the answer to
that question is 2820 different authors in 8.0.2! With many authoring more
than 10 lines of code.</p>

<p>In Symfony 8.0, 15 authors own more than 10,000 lines in the codebase, with
2 authors more than 100,000 lines of code. Can you guess who they are?</p>

<ol>
  <li>129,747 <a href="https://github.com/fabpot">Fabien Potencier</a></li>
  <li>119,275 <a href="https://github.com/nicolas-grekas">Nicolas Grekas</a></li>
  <li>47,490 <a href="https://github.com/webmozart">Bernhard Schussek</a></li>
  <li>20,639 <a href="https://github.com/derrabus">Alexander M. Turek</a></li>
  <li>19,913 <a href="https://github.com/mtarld">Mathias Arlaud</a></li>
  <li>17,385 <a href="https://github.com/alexandre-daubois">Alexandre Daubois</a></li>
  <li>13,594 <a href="https://github.com/jderusse">Jérémy Derussé</a></li>
  <li>13,518 <a href="https://github.com/lyrixx">Grégoire Pineau</a></li>
  <li>13,104 <a href="https://github.com/wouterj">Wouter de Jong</a></li>
  <li>13,057 <a href="https://github.com/weaverryan">Ryan Weaver</a></li>
  <li>12,654 <a href="https://github.com/dunglas">Kévin Dunglas</a></li>
  <li>11,929 <a href="https://github.com/keradus">Dariusz Rumiński</a></li>
  <li>11,689 <a href="https://github.com/OskarStark">Oskar Stark</a></li>
  <li>11,529 <a href="https://github.com/xabbuh">Christian Flothmann</a></li>
  <li>11,124 <a href="https://github.com/fancyweb">Thomas Calvet</a></li>
</ol>

<p>A special memory to Ryan Weaver, who <a href="https://symfony.com/blog/remembering-ryan-weaver-teacher-core-team-member-friend">passed away earlier this year after
battling with cancer</a>.
His legacy will live on in the Symfony community in ways you can’t always
describe, but these statistics underline it in ways we can describe.</p>

<h2 id="code">Code</h2>

<p>The contributors bring us to the code itself and by far my most favorite
graph of this post!</p>

<p><a href="/img/sf-stats/codeage.svg" target="_blank">
    <img src="/img/sf-stats/codeage.svg" alt="" class="figure" />
</a></p>

<aside class="side" data-type="Accuracy">
  <p>This graph uses all lines of code in XML and PHP files, excluding datasets
like Intl. However, things like a namespace declaration, license file
header, etc. are very static over the years.</p>
</aside>

<p>This graph plots how much lines of code written in any year are still
<em>untouched</em> in the latest releases. And it contains so many details about
the history of the framework!</p>

<p>First, you can see the 2.1 release more than doubling the lines of code of
the framework at the end of 2012. This followed a 3 year period of more
2.x releases before releasing 3.0 at the end of 2015.</p>

<p>You can see the rhythmic minor releases every 6 months. Each minor version
brings about 50,000 new lines of code to the codebase. With Symfony 4.3
adding the most new lines of code. This release <a href="https://symfony.com/blog/symfony-4-3-curated-new-features">introduced the Mailer, Mime
and HttpClient components</a>.</p>

<p>The little peaks every 2 years followed by a steep drop? That’s the x.4 release,
immediately followed by the next major release removing all backwards
compatibility layers. It surprises me that the total lines cleaned up every
major version is worth more or less a full minor version (50k lines!). This
shows how crucial this is in keeping the codebase manageable.</p>

<p>The big change of existing lines in early 2019 is <a href="https://github.com/symfony/symfony/pull/29903">the project switching
from oldschool <code class="highlighter-shiki">array()</code> syntax to <code class="highlighter-shiki">[]</code></a>.</p>

<p>The major version released end of 2021 removed more than a minor release
worth of code. This was the removal of <a href="https://github.com/symfony/symfony/pull/41613">the old authentication system</a>
from the Security component.</p>

<p>Symfony 8.0 packs 9 times more code than the 2.0 release. Still, thanks to
the introduction of <a href="https://fabien.potencier.org/symfony4-workflow-automation.html">Symfony Flex</a>
in Symfony 4, you only install the components required for your
application.</p>

<p>All in all, more than one third of the code in 8.0 is older than 6 years.
This speaks volumes for the maturity of the framework!</p>

<p><a href="/img/sf-stats/added-per-line.svg" target="_blank">
    <img src="/img/sf-stats/added-per-line.svg" alt="" class="figure" />
</a></p>

<p>This graph plots of the relation between total lines of code at a specific
release, and number of lines added/changed in that release. I must admit to
not fully understand what the multiplier exactly means, but it is telling
that this number still rises while the codebase is 9 times bigger than
at the start.</p>

<p><a href="/img/sf-stats/complexity.svg" target="_blank">
    <img src="/img/sf-stats/complexity.svg" alt="" class="figure" />
</a></p>

<p>The cyclomatic complexity of the Symfony codebase slightly increases over
time, although it remains mostly stable.</p>

<p>It is however interesting to see the evolution of the most complex method
in the codebase. For years, the <a href="https://github.com/symfony/symfony/blob/4.3/src/Symfony/Component/Translation/PluralizationRules.php#L33-L195">custom pluralization rules</a>
in the Translation component topped the list.</p>

<p>But since migrating to the
<a href="https://symfony.com/doc/8.0/reference/formats/message_format.html">ICU MessageFormat</a>,
the <a href="https://github.com/symfony/symfony/blob/6.1/src/Symfony/Component/ErrorHandler/DebugClassLoader.php#L356-L662">Debug Class Loader</a>
has taken over. This class is responsible for most of the deprecation
reporting for deprecated classes, changed method signatures, return types
and new interface methods.</p>

<p>Recently, the <a href="https://github.com/symfony/symfony/blob/7.3/src/Symfony/Component/Cache/Traits/RedisTrait.php#L91-L491">Redis cache connection</a>
has taken over the worst method spot, due to supporting many different
Redis extensions/libraries.</p>

<p><a href="/img/sf-stats/comments.svg" target="_blank">
    <img src="/img/sf-stats/comments.svg" alt="" class="figure" />
</a></p>

<p>Using a very minimalistic script, I also counted the lines of comment in
PHP files. This includes (multi-)line doc comments, and full line comments
starting with <code class="highlighter-shiki">//</code> or <code class="highlighter-shiki">#</code>.</p>

<p>In 2.0, almost 40% of the lines of code were comments. This was in part due
to “Captain Obvious” PHPdoc comments like <a href="https://github.com/symfony/symfony/blob/2.0/src/Symfony/Component/HttpKernel/Kernel.php#L67">“Constructor.”</a>
at every <code class="highlighter-shiki">__construct()</code> method. Symfony also used to have a convention of
adding PHPdoc comments containing only <code class="highlighter-shiki">{@inheritdoc}</code> when overriding a
parent method. Over the years, practices changed the share of comments
decreased.</p>

<p>Lately, the introducing of PHP native types and attributes helped making
even more comments redundant.</p>

<p>Of course, comments also add useful context to lines of code. Maybe this is
a metric we should focus on getting higher again in 2026!</p>

<h2 id="documentation">Documentation</h2>

<p>That brings us to my favorite corner of software: Documentation. We’ve seen
the Symfony codebase grow immensely over the years, how does the
documentation compare with this?</p>

<p><a href="/img/sf-stats/docs-over-time.svg" target="_blank">
    <img src="/img/sf-stats/docs-over-time.svg" alt="" class="figure" />
</a></p>

<aside class="side" data-type="Accuracy">
  <p>The Symfony documentation uses a maximum line length around 72 characters,
meaning the number of lines of documentation is a good indicator of words
of documentation.</p>
</aside>

<p>While not as fast as the codebase, the Symfony documentation has grown an
incredible 4 times since the initial 2.0 release. This is an impressive
statistic, given the limited size of the documentation team and
contributors. Still, the <a href="https://github.com/symfony/symfony-docs">documentation GitHub repository</a>
is one of the top active projects (for instance double the amount of
contributors compared to React).</p>

<p>Also interesting to see some of the drops in lines of documentation with
major releases. With the removal of XML and PHP Config Builder
configuration formats in Symfony 8.0, a lot of code examples and
documentation could be removed from the documentation. This not only
reduces the size of the documentation, but also improves developer
experience!</p>

<p><a href="/img/sf-stats/lines-per-docs.svg" target="_blank">
    <img src="/img/sf-stats/lines-per-docs.svg" alt="" class="figure" />
</a></p>

<p>It is also interesting to compare the number of documentation lines with
1,000 lines of Symfony code.</p>

<p>The initial release had relatively the most documentation, rapidly dropping
when Symfony 2.1 doubled its code size at the end of 2012. In 2016, the
documentation team <a href="https://symfony.com/blog/introducing-the-new-symfony-documentation">reorganized the docs</a>
from books &amp; cookbooks to the guides we have now.
Since then, this metric has been slowly decreasing but mostly stable.</p>

<p>Less documentation does not have to be a negative metric. Over the years,
the documentation team has gained tons of experience in writing more
concise and favoring code examples over large walls of text.</p>

<h2 id="conclusion">Conclusion</h2>

<p>A huge congrats to Fabien for driving the Symfony project forward for 20
years. If these graphs proofed me anything, it is that the Symfony
community has evolved over the many years and still is buzzing everywhere!</p>

<p>If you have more ideas on data to investigate, or want to try out my (very
hacky) scripts on other projects, go over to the scripts on
<a href="https://github.com/wouterj-nl/symfony-stats">GitHub</a>. But be warned: the
scripts may break at any time and running them can take a loooong time.</p>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><category term="php" /><summary type="html"><![CDATA[This year, Symfony celebrates its 20 year anniversary. Let’s dive into some statistics of years of making web development history.]]></summary></entry><entry><title type="html">Merging Unrelated Projects using Git</title><link href="https://wouterj.nl/2025/12/merging-unrelated-repositories" rel="alternate" type="text/html" title="Merging Unrelated Projects using Git" /><published>2025-12-03T00:00:00+00:00</published><updated>2025-12-03T00:00:00+00:00</updated><id>https://wouterj.nl/2025/12/merging-unrelated-repositories</id><content type="html" xml:base="https://wouterj.nl/2025/12/merging-unrelated-repositories"><![CDATA[<p>For a while, I’ve worked on a <a href="https://github.com/wouterj/symfony-docs-guides/tree/main/lib/symfony-extension">new build tool</a>
for the Symfony documentation. The project started with a fresh <code class="highlighter-shiki">git init</code>,
but now it’s time to merge it with our <a href="https://github.com/symfony-tools/docs-builder/">existing build tool</a>.
I want all contributors of the existing tool to receive credits for the
code they build, but I also don’t want to ignore all iterations of the new
build tool project. During SymfonyCon 2025 Hackday last weekend, I wanted
to find a way to achieve this. And apparently, it is straightforward… in
Git terms at least.</p>

<p>First, we need to add the new project as a remote to the old project: we
can just point to the local repository! Then, instruct Git to merge even
though both branches don’t share any common ancestors in the commit tree
using a special flag.</p>

<div class="language-bash highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #6B90C0; font-style: italic"># add a remote, pointing at the new Git project on my local filesystem</span></span>
<span class="line" data-linenr="2"><span style="color: #BBBBBB">$ git remote add </span><span style="color: #E5673D">local</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">~</span><span style="color: #BBBBBB">/projects/github.com/wouterj/docs-builder-new</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">$ git fetch </span><span style="color: #E5673D">local</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">$ git merge --allow-unrelated-histories local/main</span></span></code></pre>
</div>

<p>Without common ancestors, Git will compare the full diff leading up the
current branch and the full diff leading up the branch from the local
remote. Contributors of both projects now get credited for their work.
Pretty cool, isn’t it?</p>

<p>Using the <code class="highlighter-shiki">--allow-unrelated-histories</code> flag means you no longer have a
linear Git history; it consists of 2 separate branches at the start. <strong>Use
it for the niche use-case</strong>, and don’t make this flag your common hammer
to fix Git merge errors.</p>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><category term="git" /><summary type="html"><![CDATA[For a while, I’ve worked on a new build tool for the Symfony documentation. The project started with a fresh git init, but now it’s time to merge it with our existing build tool. I want all contributors of the existing tool to receive credits for the code they build, but I also don’t want to ignore all iterations of the new build tool project. During SymfonyCon 2025 Hackday last weekend, I wanted to find a way to achieve this. And apparently, it is straightforward… in Git terms at least.]]></summary></entry><entry><title type="html">Store Code Discussions in Git using Git Notes</title><link href="https://wouterj.nl/2024/08/git-notes" rel="alternate" type="text/html" title="Store Code Discussions in Git using Git Notes" /><published>2024-08-08T00:00:00+00:00</published><updated>2024-08-08T00:00:00+00:00</updated><id>https://wouterj.nl/2024/08/git-notes</id><content type="html" xml:base="https://wouterj.nl/2024/08/git-notes"><![CDATA[<p>Code discussions contain relevant information. Isn’t it a shame that we
keep these in the centralized GitHub/GitLab servers, far away from our
decentralized Git code? As soon as we move provider, we’ll lose all old
discussions! And how do you ever find the pull requests back from 5
years ago? Symfony has implemented a lightweight solution to this problem
years ago using a less-known feature of Git: Git Notes.</p>

<h2 id="git-notes">Git Notes?</h2>

<p>Meet one of Git’s unknown features: <a href="https://git-scm.com/docs/git-notes">Git notes</a>. They are hard
to discover… and hard to use. Yet, they provide an interesting feature:
Adding extra information to a commit, after you’ve created it.</p>

<aside class="side" data-type="Git garbage collection">
  <p>Git doesn’t immediately remove objects after a new commit replaced them.
Often, you can still find a “deleted” commit as long as you know its hash
(even on GitHub/GitLab servers). A separate process, called <a href="https://git-scm.com/docs/git-gc">garbage
collection</a>, removes old unused objects. This is often run
automatically every once in a while.</p>

</aside>

<p>Git stores all data using immutable objects. This means that you cannot
change the objects after creation. For instance, when you change a commit’s
message, Git will create a new object and remove the previous one. Git
notes are useful when you want to preserve the existing Git object, but
want to add extra data. Git notes have a many-to-one relationship with
objects: one Git object (commit) can have multiple Git notes references it.</p>

<p>Enough talking, let’s see it in practice!</p>

<p>First, create a commit:</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git commit --allow-empty -m </span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">Playing with Git notes</span><span style="color: #999999">&quot;</span></span>
<span class="line" data-linenr="2"><span style="color: #BBBBBB">[main a63c1ff] Playing with Git notes</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB"> Date: Mon Jul 8 21:18:00 2024 +0200</span></span></code></pre>
</div>

<p>Now, we can add a note to this commit using the <code class="highlighter-shiki">git notes</code> command:</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #6B90C0; font-style: italic"># &#39;a63c1ff&#39; is the object (commit) to attach this note, it defaults</span></span>
<span class="line" data-linenr="2"><span style="color: #6B90C0; font-style: italic"># to HEAD (i.e. the latest commit on the current branch)</span></span>
<span class="line" data-linenr="3"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git notes add -m </span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">Extra information of this commit</span><span style="color: #999999">&quot;</span><span style="color: #D8DEE9"> a63c1ff</span></span></code></pre>
</div>

<p>Great, we’ve added extra information to that commit! Now, we can view it by
using the <code class="highlighter-shiki">--notes</code> option:</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git log --notes</span></span>
<span class="line" data-linenr="2"><span style="color: #BBBBBB">commit a63c1ffcf90a6ee3188a086b14eebf33087aebaa (HEAD -&gt; main)</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">Author: Wouter de Jong &lt;wouter@example.com&gt;</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">Date:   Mon Jul 8 21:18:00 2024 +0200</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #BBBBBB">    Playing with Git notes</span></span>
<span class="line" data-linenr="7"></span>
<span class="line" data-linenr="8"><span style="color: #BBBBBB">Notes:</span></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    Extra information of this commit</span></span></code></pre>
</div>

<p>Cool! As you can see, the commit object didn’t change (the hash is the same
as before), but we’ve attached the new note object.</p>

<h3 id="multiple-git-notes-references">Multiple Git Notes References</h3>

<p>By default, notes are stored in the <code class="highlighter-shiki">notes/commits</code> ref. But you can
categorize Git notes into multiple references, allowing you to add multiple
types of notes to a single commit.</p>

<p>You can use the <code class="highlighter-shiki">--ref</code> option to specify the note tree:</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git notes --ref=acceptance add -m </span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">Tested-by: Jane doe &lt;jane@example.com&gt;</span><span style="color: #999999">&quot;</span></span>
<span class="line" data-linenr="2"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git log --notes=acceptance</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">commit a63c1ffcf90a6ee3188a086b14eebf33087aebaa (HEAD -&gt; main)</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">Author: Wouter de Jong &lt;wouter@example.com&gt;</span></span>
<span class="line" data-linenr="5"><span style="color: #BBBBBB">Date:   Mon Jul 8 21:18:00 2024 +0200</span></span>
<span class="line" data-linenr="6"></span>
<span class="line" data-linenr="7"><span style="color: #BBBBBB">    Playing with Git notes</span></span>
<span class="line" data-linenr="8"></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">Notes (acceptance):</span></span>
<span class="line" data-linenr="10"><span style="color: #BBBBBB">    Tested-by: Jane doe &lt;jane@example.com&gt;</span></span></code></pre>
</div>

<p>The <code class="highlighter-shiki">ref/notes/acceptance</code> now holds this new note. Using multiple
references allows us to add multiple notes to a single commit (one per
reference):</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git log --notes=commits --notes=acceptance</span></span>
<span class="line" data-linenr="2"><span style="color: #BBBBBB">commit a63c1ffcf90a6ee3188a086b14eebf33087aebaa (HEAD -&gt; main)</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">Author: Wouter de Jong &lt;wouter@example.com&gt;</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">Date:   Mon Jul 8 21:18:00 2024 +0200</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #BBBBBB">    Let&#39;s use Git notes</span></span>
<span class="line" data-linenr="7"></span>
<span class="line" data-linenr="8"><span style="color: #BBBBBB">Notes:</span></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    Extra information for this commit</span></span>
<span class="line" data-linenr="10"></span>
<span class="line" data-linenr="11"><span style="color: #BBBBBB">Notes (acceptance):</span></span>
<span class="line" data-linenr="12"><span style="color: #BBBBBB">    Tested-by: Jane doe &lt;jane@example.com&gt;</span></span></code></pre>
</div>

<aside class="side" data-type="Git Notes in practise">
  <p>Git developers use notes to store references to their mailing list like
<code class="highlighter-shiki">Message-Id: &lt;1264640755-22447-1-git-send-email-szeder@ira.uka.de&gt;</code>.</p>

  <p>You can also use notes to store other information, such as who reviewed or
tested a commit. <a href="https://gerrit.googlesource.com/plugins/reviewnotes/+/refs/heads/master/src/main/resources/Documentation/refs-notes-review.md">The reviewnotes documentation</a> shows some
examples.</p>

</aside>

<h2 id="how-symfony-uses-git-notes-to-store-github-discussions">How Symfony uses Git Notes to store GitHub Discussions</h2>

<p>Now we know a bit about Git notes, we can look at how we can use them to
store code discussions and reviews.</p>

<p>Symfony maintainers use an internal CLI tool to merge contributions. Among
other things it checks CI and core team approvals, and it helps us
automatically re-target contributions to the correct version.</p>

<p>After merging a branch using Git, the tool also uses the GitHub API to
fetch all pull request comments. The comments are stored in a Git Note and
attached to the merge commit. This way, whenever you need to find the
discussion for a particular feature, you can look up the merge commit and
read it. Even if Symfony decides to switch to another platform one day.</p>

<h3 id="storing-github-comments-in-a-note">Storing GitHub Comments in a Note</h3>

<p>First, the tool fetches the pull request comments using the <a href="https://github.com/KnpLabs/php-github-api/">GitHub API</a>
via the <a href="https://github.com/KnpLabs/php-github-api/">KnpLabs GitHub API package</a>:</p>

<div class="language-php highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> GitHub</span><span style="color: #999999">\</span><span style="color: #C7C8D2">Client</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="2"></span>
<span class="line" data-linenr="3"><span style="color: #E5673D">$</span><span style="color: #D8DEE9">github</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">Client</span><span style="color: #999999">()</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="4"><span style="color: #E5673D">$</span><span style="color: #D8DEE9">resultPager</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">ResultPager</span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">github</span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #E5673D">$</span><span style="color: #D8DEE9">prComments</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">resultPager</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">fetchAll</span><span style="color: #999999">(</span></span>
<span class="line" data-linenr="7"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">github</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">issues</span><span style="color: #999999">()</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">comments</span><span style="color: #999999">(),</span></span>
<span class="line" data-linenr="8"><span style="color: #BBBBBB">    </span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">all</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    </span><span style="color: #999999">[</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">symfony</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">symfony</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">prNumber</span><span style="color: #999999">]</span></span>
<span class="line" data-linenr="10"><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span></code></pre>
</div>

<p>Then, it loops over all comments and puts it in a temporary file:</p>

<div class="language-php highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">$</span><span style="color: #D8DEE9">notes</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #999999">&#39;&#39;</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="2"><span style="color: #E5673D">foreach</span><span style="color: #BBBBBB"> </span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">prComments</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">as</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">comment</span><span style="color: #999999">)</span><span style="color: #BBBBBB"> </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">notes</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">.=</span><span style="color: #BBBBBB"> </span><span style="color: #999999">&lt;&lt;&lt;</span><span style="color: #E5673D">EOF</span></span>
<span class="line" data-linenr="4"><span style="color: #7CC64A">---------------------------------------------------------------------------</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #7CC64A">by </span><span style="color: #E5673D">{$</span><span style="color: #D8DEE9">comment</span><span style="color: #999999">[&#39;</span><span style="color: #7CC64A">user</span><span style="color: #999999">&#39;][&#39;</span><span style="color: #7CC64A">login</span><span style="color: #999999">&#39;]</span><span style="color: #E5673D">}</span><span style="color: #7CC64A"> at </span><span style="color: #E5673D">{$</span><span style="color: #D8DEE9">comment</span><span style="color: #999999">[&#39;</span><span style="color: #7CC64A">created_at</span><span style="color: #999999">&#39;]</span><span style="color: #E5673D">}</span></span>
<span class="line" data-linenr="7"></span>
<span class="line" data-linenr="8"><span style="color: #E5673D">{$</span><span style="color: #D8DEE9">comment</span><span style="color: #999999">[&#39;</span><span style="color: #7CC64A">body</span><span style="color: #999999">&#39;]</span><span style="color: #E5673D">}</span></span>
<span class="line" data-linenr="9"></span>
<span class="line" data-linenr="10"></span>
<span class="line" data-linenr="11"><span style="color: #7CC64A">    </span><span style="color: #E5673D">EOF</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="12"><span style="color: #999999">}</span></span>
<span class="line" data-linenr="13"></span>
<span class="line" data-linenr="14"><span style="color: #C7C8D2">file_put_contents</span><span style="color: #999999">(</span><span style="color: #C7C8D2">getcwd</span><span style="color: #999999">()</span><span style="color: #E5673D">.</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">/.notes</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">notes</span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span></code></pre>
</div>

<p>Now, we can create a Git note from the file contents (Symfony puts them in
a named “github-comments” reference):</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #6B90C0; font-style: italic"># first, replace the local github-comments ref with the upstream one</span></span>
<span class="line" data-linenr="2"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git fetch origin refs/notes/github-comments:refs/notes/github-comments</span></span>
<span class="line" data-linenr="3"></span>
<span class="line" data-linenr="4"><span style="color: #6B90C0; font-style: italic"># then, create the new note</span></span>
<span class="line" data-linenr="5"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git notes --ref=github-comments add --file=.notes</span></span></code></pre>
</div>

<p>Finally, we can push the notes to GitHub. Git doesn’t push notes by
default, we have to mention the reference explicitly:</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git push --no-follow-tags origin refs/notes/github-comments</span></span></code></pre>
</div>

<aside class="side" data-type="Distributed Code Reviews">
  <p>This implementation only distributes the code discussions together with the
code.</p>

  <p>Some developers at Google took the concept one level further and created
<a href="https://github.com/google/git-appraise">Git Appraise</a>, a distributed code review implementation
(including requesting and reviewing itself).</p>

</aside>

<h3 id="reading-the-notes-back">Reading the Notes back</h3>

<p>GitHub no longer shows the <code class="highlighter-shiki">refs/notes/...</code> objects anywhere. But as it is
just another set of objects (just like the commit tree), you can still
push and fetch it from GitHub if you reference it directly:</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git fetch origin refs/notes/github-comments:refs/notes/github-comments</span></span>
<span class="line" data-linenr="2"></span>
<span class="line" data-linenr="3"><span style="color: #6B90C0; font-style: italic"># or fetch all note references</span></span>
<span class="line" data-linenr="4"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git fetch origin </span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">refs/notes/*:refs/notes/*</span><span style="color: #999999">&quot;</span></span></code></pre>
</div>

<p>You can also edit the <code class="highlighter-shiki">.git/config</code> file of a project to always fetch
notes by default:</p>

<div class="language-diff highlighter-shiki"><pre class="shiki-gutter">1
2
3
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #BBBBBB">  [remote &quot;origin&quot;]</span></span>
<span class="line" data-linenr="2"><span style="color: #BBBBBB">    fetch = +refs/heads/*:refs/remotes/origin/*</span></span>
<span class="line" data-linenr="3"><span style="color: #999999">+</span><span style="color: #7CC64A">   fetch = +refs/notes/*:refs/notes/*</span></span></code></pre>
</div>

<p>Now the notes exist locally, you can view them in the Git logs for instance:</p>

<div class="language-terminal highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #999999">$ </span><span style="color: #D8DEE9">git log --notes=github-comments</span></span>
<span class="line" data-linenr="2"><span style="color: #BBBBBB">commit 1a16ebc32598faada074e0af12a6a698d2964a5e (HEAD -&gt; 7.2, origin/7.2)</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">Merge: 09f9eb73b6 1303cd1a56</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">Author: Nicolas Grekas &lt;nicolas.grekas@gmail.com&gt;</span></span>
<span class="line" data-linenr="5"><span style="color: #BBBBBB">Date:   Wed Jul 10 17:23:17 2024 +0200</span></span>
<span class="line" data-linenr="6"></span>
<span class="line" data-linenr="7"><span style="color: #BBBBBB">    minor #57657 [Messenger] [SQS] Allow to pass `sslmode` as an option (spuf)</span></span>
<span class="line" data-linenr="8"></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    This PR was merged into the 7.2 branch.</span></span>
<span class="line" data-linenr="10"></span>
<span class="line" data-linenr="11"><span style="color: #BBBBBB">    Discussion</span></span>
<span class="line" data-linenr="12"><span style="color: #BBBBBB">    ----------</span></span>
<span class="line" data-linenr="13"></span>
<span class="line" data-linenr="14"><span style="color: #BBBBBB">    [Messenger] [SQS] Allow to pass `sslmode` as an option</span></span>
<span class="line" data-linenr="15"></span>
<span class="line" data-linenr="16"><span style="color: #BBBBBB">    | Q             | A</span></span>
<span class="line" data-linenr="17"><span style="color: #BBBBBB">    | ------------- | ---</span></span>
<span class="line" data-linenr="18"><span style="color: #BBBBBB">    | Branch?       | 7.2</span></span>
<span class="line" data-linenr="19"><span style="color: #BBBBBB">    | Bug fix?      | no</span></span>
<span class="line" data-linenr="20"><span style="color: #BBBBBB">    | New feature?  | no</span></span>
<span class="line" data-linenr="21"><span style="color: #BBBBBB">    | Deprecations? | no</span></span>
<span class="line" data-linenr="22"><span style="color: #BBBBBB">    | Issues        |</span></span>
<span class="line" data-linenr="23"><span style="color: #BBBBBB">    | License       | MIT</span></span>
<span class="line" data-linenr="24"></span>
<span class="line" data-linenr="25"><span style="color: #BBBBBB">    This is a minor. There is an option &quot;sslmode&quot; that is documented as an option but can be passed only in dsn query string.</span></span>
<span class="line" data-linenr="26"></span>
<span class="line" data-linenr="27"><span style="color: #BBBBBB">    Commits</span></span>
<span class="line" data-linenr="28"><span style="color: #BBBBBB">    -------</span></span>
<span class="line" data-linenr="29"></span>
<span class="line" data-linenr="30"><span style="color: #BBBBBB">    1303cd1a56 [Messenger][SQS] Allow to pass sslmode as an option</span></span>
<span class="line" data-linenr="31"></span>
<span class="line" data-linenr="32"><span style="color: #BBBBBB">Notes (github-comments):</span></span>
<span class="line" data-linenr="33"><span style="color: #BBBBBB">    ---------------------------------------------------------------------------</span></span>
<span class="line" data-linenr="34"></span>
<span class="line" data-linenr="35"><span style="color: #BBBBBB">    by carsonbot at 2024-07-04T20:10:34Z</span></span>
<span class="line" data-linenr="36"></span>
<span class="line" data-linenr="37"><span style="color: #BBBBBB">    Hey!</span></span>
<span class="line" data-linenr="38"></span>
<span class="line" data-linenr="39"><span style="color: #BBBBBB">    I see that this is your first PR. That is great! Welcome!</span></span>
<span class="line" data-linenr="40"></span>
<span class="line" data-linenr="41"><span style="color: #BBBBBB">    ...</span></span></code></pre>
</div>

<h2 id="summary">Summary</h2>

<ul>
  <li>It’s important to distribute more than just the code</li>
  <li>Use Git notes to store all sorts of important information to commits</li>
  <li>You can view old Symfony discussions offline by using the
<code class="highlighter-shiki">github-comments</code> notes reference</li>
</ul>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><category term="git," /><category term="documentation" /><summary type="html"><![CDATA[Code discussions contain relevant information. Isn’t it a shame that we keep these in the centralized GitHub/GitLab servers, far away from our decentralized Git code? As soon as we move provider, we’ll lose all old discussions! And how do you ever find the pull requests back from 5 years ago? Symfony has implemented a lightweight solution to this problem years ago using a less-known feature of Git: Git Notes.]]></summary></entry><entry><title type="html">Combatting Login CSRF with Symfony</title><link href="https://wouterj.nl/2023/10/combatting-login-csrf-with-symfony" rel="alternate" type="text/html" title="Combatting Login CSRF with Symfony" /><published>2023-10-19T00:00:00+00:00</published><updated>2023-10-19T00:00:00+00:00</updated><id>https://wouterj.nl/2023/10/combatting-login-csrf-with-symfony</id><content type="html" xml:base="https://wouterj.nl/2023/10/combatting-login-csrf-with-symfony"><![CDATA[<p>Cross-site Request Forgery (CSRF) is one of the traditional vulnerabilities
that web applications have to deal with. Every web framework - including
Symfony - supports CSRF protection out of the box. A lesser known
vulnerability is <em>Login CSRF</em>, a special kind of CSRF attack.</p>

<h2 id="how-a-csrf-attack-works">How a CSRF Attack Works</h2>

<p>A <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">CSRF attack</a> takes advantage of the sessions in the browser. If you
login to a website, your authentication token is stored in a session. This
means that you’re still logged in if you switch to another page of the
website.</p>

<p>The browser also remembers this session when visiting other websites. This
is nice, as it allows you to go back to the website and still be logged in.
However, attackers are using this to make requests from their website to
your website using the remembered authentication session. This means that,
without CSRF protection, it can use your website as if it was the user.</p>

<p>For instance, an attacker can trick the user into thinking they are on your
website and show them a form that looks like the login:</p>

<div class="language-html highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">&lt;form</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">action</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">https://yourwebsite.com/profile/change_password</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">method</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">POST</span><span style="color: #999999">&quot;</span><span style="color: #E5673D">&gt;</span></span>
<span class="line" data-linenr="2"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">&lt;label&gt;</span><span style="color: #BBBBBB">Username </span><span style="color: #E5673D">&lt;input</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">type</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">text</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">name</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">username</span><span style="color: #999999">&quot;</span><span style="color: #E5673D">&gt;&lt;/label&gt;</span></span>
<span class="line" data-linenr="3"></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">&lt;label&gt;</span><span style="color: #BBBBBB">Password </span><span style="color: #E5673D">&lt;input</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">type</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">password</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">name</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">current_password</span><span style="color: #999999">&quot;</span><span style="color: #E5673D">&gt;&lt;/label&gt;</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">&lt;input</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">type</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">hidden</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">name</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">new_password</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">value</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">...</span><span style="color: #999999">&quot;</span><span style="color: #E5673D">&gt;</span></span>
<span class="line" data-linenr="7"></span>
<span class="line" data-linenr="8"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">&lt;button</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">type</span><span style="color: #999999">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">submit</span><span style="color: #999999">&quot;</span><span style="color: #E5673D">&gt;</span><span style="color: #BBBBBB">Login</span><span style="color: #E5673D">&lt;/button&gt;</span></span>
<span class="line" data-linenr="9"><span style="color: #E5673D">&lt;/form&gt;</span></span></code></pre>
</div>

<p>In reality (looking at the <code class="highlighter-shiki">action</code> and <code class="highlighter-shiki">type=&quot;hidden&quot;</code> input), this form
changes the password of the user to something that is known only by the
attacker, giving them access to their account. Attacks can also do any
other action on your website, like buying goods or transfering money to
their account.</p>

<h2 id="how-login-csrf-attacks-are-different">How Login CSRF Attacks are Different</h2>

<p>The CSRF attacks described above are <em>using the authenticated session</em> to
act as a user. <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#login-csrf">Login CSRF attacks</a> are the opposite: they <em>force an
authenticated session</em> to let the user act as them.</p>

<p>How does that work? When someone visits the website of an attacker, they
make a request to <code class="highlighter-shiki">yourwebsite.com/logout</code> to force an unauthenticated
session and then make a request to <code class="highlighter-shiki">yourwebsite.com/login</code> with
credentials of an account that they control.</p>

<aside class="side" data-type="side note">
  <p>With the introduction of <code class="highlighter-shiki">Secure</code> and <code class="highlighter-shiki">SameSite</code> cookie flags, there has
been a feeling that <a href="https://scotthelme.co.uk/csrf-is-really-dead/">CSRF is dead</a>. Login CSRF is a good example of a
situation where these cookie flags won’t protect your users against a CSRF
attack. While the web is more secure thanks to these cookie flags, CSRF
still has its function in modern web applications.</p>
</aside>

<p>This can have serious consequences for the user, depending on the
functionality of your website. E.g. <a href="https://seclab.stanford.edu/websec/csrf/csrf.pdf">“Robust Defenses for Cross-Site Request
Forgery” (Barth, Jackson, Mitchell, 2008)</a> mention that this attack is
used to let users unknowingly connect their creditcard to the PayPal
account of the attacker. It is also used to get access to a user’s Google
account, or using it to track the user’s search terms and locations.</p>

<p>The risk of Login CSRF attacks is often considered to be lower. Most users
are expected to notice when they are logged in to someone else’s account on
the website (hence it’s a good idea to make this visible on all pages!).
However, the consequences can be very high when a user doesn’t notice. If
you’re using Symfony, protecting against them is very easy and I would
recommend always doing this.</p>

<h2 id="protecting-against-login-csrf">Protecting against Login CSRF</h2>

<p>A login CSRF attack can include two steps: first a call to logout to force
the website in a known state, and then a login with the attackers
credentials. Let’s protect both steps!</p>

<h3 id="protecting-login">Protecting Login</h3>

<p>Protecting against login CSRF attacks is similar to protecting against
other CSRF attacks. When rendering the login form, you create a randomized
token which you submit along with the rest of the form. When handling the
submission, this token is checked for validity.</p>

<p>When using Symfony’s built-in <code class="highlighter-shiki">form_login</code> authenticator, generating and
validating this randomized token is mostly automated for you. First, enable
CSRF protection in the authenticator:</p>

<div class="language-yaml highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #C7C8D2">security</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="2"><span style="color: #999999">    </span><span style="color: #6B90C0; font-style: italic"># ...</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">    </span><span style="color: #C7C8D2">firewalls</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">        </span><span style="color: #C7C8D2">main</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="5"><span style="color: #BBBBBB">            </span><span style="color: #C7C8D2">form_login</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="6"><span style="color: #999999">                </span><span style="color: #6B90C0; font-style: italic"># ...</span></span>
<span class="line" data-linenr="7"><span style="color: #BBBBBB">                </span><span style="color: #C7C8D2">enable_csrf</span><span style="color: #999999">:</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">true</span></span></code></pre>
</div>

<p>And then, add a hidden CSRF token to your login form template:</p>

<div class="language-twig highlighter-shiki"><pre class="shiki-gutter">1
2
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #6B90C0; font-style: italic">&lt;!-- csrf_token() takes care of correctly generating and storing the CSRF token --&gt;</span></span>
<span class="line" data-linenr="2"><span style="color: #E5673D">&lt;input</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">type</span><span style="color: #BBBBBB">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">hidden</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">name</span><span style="color: #BBBBBB">=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">_csrf_token</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">value</span><span style="color: #BBBBBB">=</span><span style="color: #999999">&quot;{{</span><span style="color: #7CC64A"> </span><span style="color: #C7C8D2">csrf_token</span><span style="color: #999999">(&#39;</span><span style="color: #7CC64A">authenticate</span><span style="color: #999999">&#39;)</span><span style="color: #7CC64A"> </span><span style="color: #999999">}}&quot;</span><span style="color: #E5673D">&gt;</span></span></code></pre>
</div>

<p>That’s it! Your users are safe against this attack now!</p>

<p>When you’re using a custom login form authenticator, you’ll have to add
<a href="https://symfony.com/doc/current/security/custom_authenticator.html#passport-badges">the <code class="highlighter-shiki">CsrfTokenBadge</code></a> with the CSRF token from the request. The
security system will then validate this token for you.</p>

<h3 id="protecting-logout">Protecting Logout</h3>

<aside class="side" data-type="Symfony &lt;6.2">
  <p>The <code class="highlighter-shiki">enable_csrf</code> option is new in Symfony 6.2. If you’re stuck on
an older version, you need to use <code class="highlighter-shiki">csrf_token_generator: security.csrf.token_manager</code>
instead. Read more about it in <a href="https://symfony.com/doc/5.4/reference/configuration/security.html#reference-security-logout-csrf">the documentation</a>.</p>
</aside>

<p>You can protect logout in a similar way by enabling CSRF protection in the
config:</p>

<div class="language-yaml highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #C7C8D2">security</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="2"><span style="color: #999999">    </span><span style="color: #6B90C0; font-style: italic"># ...</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">    </span><span style="color: #C7C8D2">firewalls</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">        </span><span style="color: #C7C8D2">main</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="5"><span style="color: #BBBBBB">            </span><span style="color: #C7C8D2">logout</span><span style="color: #999999">:</span></span>
<span class="line" data-linenr="6"><span style="color: #999999">                </span><span style="color: #6B90C0; font-style: italic"># ...</span></span>
<span class="line" data-linenr="7"><span style="color: #BBBBBB">                </span><span style="color: #C7C8D2">enable_csrf</span><span style="color: #999999">:</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">true</span></span></code></pre>
</div>

<p>If you’re already using the <code class="highlighter-shiki">logout_path()</code> Twig helper function to
generate a URL to your logout route, this is all you had to do! The Twig
function generates a unique CSRF token and attaches it to the URL.</p>

<p>Otherwise, replace links to the logout page with this Twig function in your
Twig templates:</p>

<div class="language-twig highlighter-shiki"><pre class="shiki-gutter">1
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">&lt;a</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">href</span><span style="color: #BBBBBB">=</span><span style="color: #999999">&quot;{{</span><span style="color: #7CC64A"> logout_path</span><span style="color: #999999">()</span><span style="color: #7CC64A"> </span><span style="color: #999999">}}&quot;</span><span style="color: #E5673D">&gt;</span><span style="color: #BBBBBB">Logout</span><span style="color: #E5673D">&lt;/a&gt;</span></span></code></pre>
</div>

<h2 id="take-homes">Take Homes</h2>

<ul>
  <li>Make sure your login/logout actions are also protected against CSRF
attacks</li>
  <li>While cookies have become more secure in recent years, CSRF protection
still needs attention</li>
</ul>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><summary type="html"><![CDATA[Cross-site Request Forgery (CSRF) is one of the traditional vulnerabilities that web applications have to deal with. Every web framework - including Symfony - supports CSRF protection out of the box. A lesser known vulnerability is Login CSRF, a special kind of CSRF attack.]]></summary></entry><entry><title type="html">Using the SecurityBundle in Symfony 6</title><link href="https://wouterj.nl/2021/12/security-winterworld21" rel="alternate" type="text/html" title="Using the SecurityBundle in Symfony 6" /><published>2021-12-10T00:00:00+00:00</published><updated>2021-12-10T00:00:00+00:00</updated><id>https://wouterj.nl/2021/12/security-winterworld21</id><content type="html" xml:base="https://wouterj.nl/2021/12/security-winterworld21"><![CDATA[<p>At SymfonyWorld Winter 2021, I talked about using the new Symfony
authentication system in your applications in Symfony 6. We discussed
the important changes to the Security component, what we tried to
improve with each change, and how you can use these to make a more
secure application quicker.</p>

<embed src="/assets/uploads/sfwinterworld21-talk.pdf" class="post__slides" />

<h2 id="references--features">References &amp; Features</h2>

<ul>
  <li>The security makers in <a href="https://symfony.com/bundles/SymfonyMakerBundle/current/index.html">Symfony MakerBundle</a></li>
  <li><a href="https://symfony.com/doc/current/security/#the-user">Minimalized <code class="highlighter-shiki">UserInterface</code></a></li>
  <li>SymfonyCasts <a href="https://github.com/SymfonyCasts/verify-email-bundle">VerifyEmailBundle</a>
and <a href="https://github.com/SymfonyCasts/reset-password-bundle">ResetPasswordBundle</a></li>
  <li>Built-in <a href="https://symfony.com/doc/current/security/#form-login">form login authenticator</a> and
<a href="https://symfony.com/doc/current/security/#json-login">json login authenticator</a>
(<a href="https://symfony.com/doc/current/security.html#authenticating-users">all built-in authenticators</a>)</li>
  <li>The new Security profiler</li>
  <li><a href="https://github.com/lexik/LexikJWTAuthenticationBundle">LexikJWTAuthenticationBundle</a>,
<a href="https://github.com/hslavich/OneloginSamlBundle">OneloginSamlBundle</a>,
<a href="https://github.com/web-auth/webauthn-symfony-bundle">WebauthnSymfonyBundle</a>,
<a href="https://github.com/knpuniversity/oauth2-client-bundle">KnpUOauth2ClientBundle</a> and
<a href="https://symfony.com/bundles/SchebTwoFactorBundle/current/index.html">SchebTwoFactorBundle</a></li>
  <li>The new <a href="https://symfony.com/doc/current/security/#security-events">Security event cycle</a></li>
  <li>The new <a href="https://symfony.com/blog/new-in-symfony-5-4-profiler-improvements#more-security-information-in-the-profiler"><code class="highlighter-shiki">debug:firewall</code> command</a></li>
  <li>Symfony <a href="https://symfony.com/doc/current/security/custom_authenticator.html#security-passport">security Passports</a></li>
  <li>The new <code class="highlighter-shiki">required_badges</code> setting</li>
  <li>Implementing <a href="https://symfony.com/doc/current/security/custom_authenticator.html">custom authenticators</a></li>
  <li><a href="https://symfony.com/doc/5.2/security/experimental_authenticators.html">Using the new authentication system in Symfony 5</a></li>
  <li>All code of this talk in an example application: <a href="https://github.com/wouterj-nl/security-winterworld21">https://github.com/wouterj-nl/security-winterworld21</a></li>
</ul>]]></content><author><name>Wouter de Jong</name></author><category term="talk" /><category term="symfony" /><summary type="html"><![CDATA[At SymfonyWorld Winter 2021, I talked about using the new Symfony authentication system in your applications in Symfony 6. We discussed the important changes to the Security component, what we tried to improve with each change, and how you can use these to make a more secure application quicker.]]></summary></entry><entry><title type="html">Deprecations are not like E_ERROR, E_WARNING, and E_NOTICE</title><link href="https://wouterj.nl/2021/11/deprecations-are-not-errors" rel="alternate" type="text/html" title="Deprecations are not like E_ERROR, E_WARNING, and E_NOTICE" /><published>2021-11-13T00:00:00+00:00</published><updated>2021-11-13T00:00:00+00:00</updated><id>https://wouterj.nl/2021/11/deprecations-are-not-errors</id><content type="html" xml:base="https://wouterj.nl/2021/11/deprecations-are-not-errors"><![CDATA[<p>Every now and then, there seems to be a lot of fuss in the PHP community
about deprecations. In these discussions, deprecations are often
discussed as if they are fatal errors. I think that is very wrong. Let’s
reduce our expectations of deprecations. It’ll make everyones live much
less stressful.</p>

<h2 id="why-we-were-afraid-of-change-in-the-past">Why we were Afraid of Change in the Past</h2>

<aside class="side" data-type="side note">
  <p>I can’t think of a world without deprecations and backwards
compatibility nowadays. The PHP community has matured fast. The
semantic versioning specification, which I think has ignited the
backwards compatibility movement, was published only 8 years ago
in 2013. In this same year, Symfony triggered its first ever deprecation
notice.</p>
</aside>

<p>In the past, the only way to know about a change in the next version was
by reading the CHANGELOGs. Every change required you to manually check
if your code was affected.</p>

<p>Mind you, even Composer was not a thing 8 years ago. Most applications
would just copy past the vendor code in their project (sometimes even
altering code in the vendor).</p>

<p>This took time, a lot of time. As a consequence, languages and
libraries were very restricted in how they could evolve.</p>

<h2 id="why-php-developers-are-afraid-of-any-e_-being-reported">Why PHP Developers are Afraid of any <code class="highlighter-shiki">E_*</code> being Reported</h2>

<p>PHP had a habit of trying to “fix” incorrect code. Forgot the quotes
around a string? No worries, <a href="https://3v4l.org/m0l3p">PHP still interpreted it as a
string</a> if the constant wasn’t found. It
triggered an <code class="highlighter-shiki">E_NOTICE</code> to let you know that PHP found something
unexpected but tried to continue.</p>

<p>This can produce unexpected behavior (e.g. what if you meant a constant,
but you made a typo?). As a result, PHP developers have become extremely
careful with anything being reported. Even though it’s not a direct fatal
error, many of us correctly consider notices to be something that must
be fixed.</p>

<p>However, this also makes us very careful with <code class="highlighter-shiki">E_DEPRECATED</code>. After all,
it’s reported and it starts with <code class="highlighter-shiki">E_</code>. That MUST be fixed as soon as
possible, right? …right?</p>

<h2 id="why-deprecations-are-different">Why Deprecations are Different</h2>

<p>Deprecations are not like notices, warnings or errors. Deprecations are
the cornerstone in <em>smooth upgrade paths</em>. This smooth upgrade path
contains a couple steps:</p>

<ol>
  <li>A contributor makes a backwards compatibility breaking change</li>
  <li>The contributor introduces a “BC layer” to make sure the old API
also works. This “BC layer” triggers a deprecation, notifying that
you’re using a legacy API</li>
  <li>In the next major version, a maintainer removes the “BC layer” and
the new API is the only available API</li>
</ol>

<p>This means that a <em>user</em> can use the old API as long as they want, until
they want to upgrade to the next major version.</p>

<aside class="side" data-type="side note">
  <p>The smooth upgrade path is such an improvement that most maintainers
have to get used to it. Most developers love refactoring legacy bits,
and I think it’s normal to “overshoot” it at first. Maintainers will
learn from this (I’m sure the hard upgrade from Symfony 3.4 is not
repeated again).</p>

  <p>Give them constructive feedback on what made an upgrade hard for your
applications. Don’t judge them for making changes, help them improve
further changes.</p>
</aside>

<p>A deprecation is a major help for us <em>users</em>. Instead of being notified
only after the major release (by reading the CHANGELOG), we get notified
years or months in advance. For instance, you have at least 3 years to
fix any deprecation that Symfony gives you.</p>

<h2 id="you-dont-have-to-run-deprecation-free">You don’t have to run Deprecation-free</h2>

<p>Using a deprecated feature doesn’t result in unpredictable behavior,
like PHP’s notices do. They don’t signal a bug, like warnings and errors
do. They just tell you that you have some work to do before upgrading to
the next major version. That’s all!</p>

<p>With deprecations, you can prioritize upgrade work and reserve some time
for it in a 2 or 3 year timespan. Backwards compatibility breaks are no
longer ad-hoc tasks, they become plannable tasks.</p>

<p>Is your business busy the next few months? Fine! Your apps remain
running with tons of deprecations for months to come. There will always
be a boring week in the summer break were you can fix a couple
deprecations.</p>

<p>Most often, when a new deprecation is introduced, the major version is not
even being worked on. For instance, if PHP triggers a deprecation now,
you’re notified of a breaking change in PHP 9. Do you know the release
date of PHP 9? I don’t (probably one or two years from now?). Is it
really worth worrying so much today about a breaking change in an
unknown future?</p>

<h2 id="dont-judge-your-vendor-code-for-not-running-deprecation-free">Don’t Judge your Vendor Code for not running Deprecation-free</h2>

<p>The same applies to any vendor code that your app is using. Getting
deprecation notices from a vendor library? That’s fine. You can reserve
some time and contribute a fix for one or two deprecations to the open
source project.</p>

<p>If we all do it, the open source project will support the new major
version months before it’s even released.</p>

<h2 id="how-to-hide-and-log-deprecations">How to Hide and Log Deprecations</h2>

<p>If you are using the default PHP error handler, you’re left to either
hide deprecations or output them like all other errors. Symfony has a
small <a href="https://github.com/symfony/error-handler"><code class="highlighter-shiki">symfony/error-handler</code></a>
package that allows you to register <a href="https://php-fig.org/psr/psr-3/">PSR-3 loggers</a>
for a specific error level. Besides, it automatically hides
deprecations from the normal output.</p>

<p>Using this code, all deprecations are logged to <code class="highlighter-shiki">deprecation.log</code> and
the normal error handler is used for all other errors:</p>

<div class="language-php highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">&lt;?</span><span style="color: #BBBBBB">php</span></span>
<span class="line" data-linenr="2"></span>
<span class="line" data-linenr="3"><span style="color: #E5673D">require_once</span><span style="color: #BBBBBB"> </span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">vendor/autoload.php</span><span style="color: #999999">&#39;</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="4"></span>
<span class="line" data-linenr="5"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Psr</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Log</span><span style="color: #999999">\</span><span style="color: #C7C8D2">AbstractLogger</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="6"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">ErrorHandler</span><span style="color: #999999">\</span><span style="color: #C7C8D2">ErrorHandler</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="7"></span>
<span class="line" data-linenr="8"><span style="color: #C7C8D2">ErrorHandler</span><span style="color: #E5673D">::</span><span style="color: #C7C8D2">register</span><span style="color: #999999">()</span></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">setDefaultLogger</span><span style="color: #999999">(</span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">class</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">extends</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">AbstractLogger</span><span style="color: #BBBBBB"> </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="10"><span style="color: #BBBBBB">        </span><span style="color: #E5673D">public</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">function</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">log</span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">level</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">string</span><span style="color: #999999">|\</span><span style="color: #C7C8D2">Stringable</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">message</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">array</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #999999">[])</span><span style="color: #E5673D">:</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">void</span></span>
<span class="line" data-linenr="11"><span style="color: #BBBBBB">        </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="12"><span style="color: #BBBBBB">            </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">formattedLogLine</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">sprintf</span><span style="color: #999999">(</span></span>
<span class="line" data-linenr="13"><span style="color: #C7C8D2">                </span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">[%s] %s: %s%s</span><span style="color: #999999">&#39;</span><span style="color: #E5673D">.</span><span style="color: #E5673D">PHP_EOL</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="14"><span style="color: #C7C8D2">                date</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">Y-m-dTH:i:s.uP</span><span style="color: #999999">&#39;</span><span style="color: #999999">),</span></span>
<span class="line" data-linenr="15"><span style="color: #C7C8D2">                </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">level</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="16"><span style="color: #C7C8D2">                </span><span style="color: #999999">(</span><span style="color: #E5673D">string</span><span style="color: #999999">)</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">message</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="17"><span style="color: #C7C8D2">                </span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #999999">[</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">exception</span><span style="color: #999999">&#39;</span><span style="color: #999999">]</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">??</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">false</span><span style="color: #999999">)</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">instanceof</span><span style="color: #C7C8D2"> </span><span style="color: #999999">\</span><span style="color: #C7C8D2">Throwable</span></span>
<span class="line" data-linenr="18"><span style="color: #C7C8D2">                    </span><span style="color: #E5673D">?</span><span style="color: #C7C8D2"> </span><span style="color: #C7C8D2">sprintf</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A"> in %s:%s</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #999999">[</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">exception</span><span style="color: #999999">&#39;</span><span style="color: #999999">]</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">getFile</span><span style="color: #999999">(),</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #999999">[</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">exception</span><span style="color: #999999">&#39;</span><span style="color: #999999">]</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">getLine</span><span style="color: #999999">())</span></span>
<span class="line" data-linenr="19"><span style="color: #C7C8D2">                    </span><span style="color: #E5673D">:</span><span style="color: #C7C8D2"> </span><span style="color: #999999">&#39;&#39;</span></span>
<span class="line" data-linenr="20"><span style="color: #C7C8D2">            </span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="21"></span>
<span class="line" data-linenr="22"><span style="color: #BBBBBB">            </span><span style="color: #C7C8D2">file_put_contents</span><span style="color: #999999">(</span><span style="color: #E5673D">__DIR__</span><span style="color: #E5673D">.</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">/deprecations.log</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">formattedLogLine</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #999999">\</span><span style="color: #E5673D">FILE_APPEND</span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="23"><span style="color: #BBBBBB">        </span><span style="color: #999999">}</span></span>
<span class="line" data-linenr="24"><span style="color: #BBBBBB">    </span><span style="color: #999999">},</span><span style="color: #BBBBBB"> </span><span style="color: #999999">\</span><span style="color: #E5673D">E_DEPRECATED</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">|</span><span style="color: #BBBBBB"> </span><span style="color: #999999">\</span><span style="color: #E5673D">E_USER_DEPRECATED</span><span style="color: #999999">)</span></span>
<span class="line" data-linenr="25"><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="26"></span>
<span class="line" data-linenr="27"><span style="color: #6B90C0; font-style: italic">// &quot;null&quot; argument deprecated as of PHP 8.1</span></span>
<span class="line" data-linenr="28"><span style="color: #C7C8D2">var_dump</span><span style="color: #999999">(</span><span style="color: #C7C8D2">str_contains</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">foo</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">null</span><span style="color: #999999">))</span><span style="color: #E5673D">;</span></span></code></pre>
</div>

<h2 id="take-homes">Take Home’s</h2>

<ul>
  <li>Don’t try to run deprecation free until you want to upgrade to a new
major</li>
  <li>Don’t judge maintainers triggering deprecations, thank them for
letting you know about a big change way in advance</li>
  <li>Deprecations make upgrade tasks plannable, instead of ad-hoc</li>
</ul>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><category term="backwards-compatibility" /><summary type="html"><![CDATA[Every now and then, there seems to be a lot of fuss in the PHP community about deprecations. In these discussions, deprecations are often discussed as if they are fatal errors. I think that is very wrong. Let’s reduce our expectations of deprecations. It’ll make everyones live much less stressful.]]></summary></entry><entry><title type="html">Symfony 6: PHP 8 Native Types &amp;amp; Why we Need YOU</title><link href="https://wouterj.nl/2021/09/symfony-6-native-typing" rel="alternate" type="text/html" title="Symfony 6: PHP 8 Native Types &amp;amp; Why we Need YOU" /><published>2021-09-10T00:00:00+00:00</published><updated>2021-09-10T00:00:00+00:00</updated><id>https://wouterj.nl/2021/09/symfony-6-native-typing</id><content type="html" xml:base="https://wouterj.nl/2021/09/symfony-6-native-typing"><![CDATA[<p>A very exciting time is coming with the biggest change for Symfony since
Symfony 2.0: Symfony 6 has native PHP types on all its methods where it
is possible. This will be a great push towards type safety in the PHP
open source communities! <a href="https://github.com/sponsors/nicolas-grekas">Nicolas</a> and
<a href="https://github.com/derrabus">Alexander</a> have been working on and off for 2 years to create
the best upgrade experience possible.<br />
Now, 2.5 months before the stable release, it is <em>YOUR</em> time to shine!
Especially if you maintain any open source project (not even directly
linked to Symfony), we would love to hear from you to make sure the
upgrade isn’t dramatically hard.</p>

<p>As of Symfony 5.4, the debug class loader (which is used in Symfony
applications in the dev/test env) will check return type compatibility
and warn you if a method is incompatible. Even more… it can fix it
automatically for you! <a href="https://symfony.com/doc/5.4/setup/upgrade_major.html#upgrading-to-symfony-6-add-native-return-types">Read more about this feature in the Symfony
docs.</a></p>

<h2 id="symfony-applications-upgrade-plan">Symfony Applications Upgrade Plan</h2>

<p>The upgrade plan is slightly different for open source packages and
applications. This section describes your upgrade plan if you’re
building applications using the Symfony framework (or only some
components).</p>

<p>The techniques and tools created to make this experience as smooth as
possible are brand-new. Please install 5.4-dev now and let us <a href="https://github.com/symfony/symfony/issues/new/choose">know about
any issue</a>.</p>

<div class="language-bash highlighter-shiki"><pre class="shiki-gutter">1
2
3
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #BBBBBB">$ composer config minimum-stability dev</span></span>
<span class="line" data-linenr="2"><span style="color: #6B90C0; font-style: italic"># now, modify all Symfony constraints to &quot;^5.4&quot; in &quot;composer.json&quot;, then:</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">$ composer update </span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">symfony/*</span><span style="color: #999999">&#39;</span></span></code></pre>
</div>

<h3 id="when-upgrading-to-symfony-54">When upgrading to Symfony 5.4</h3>

<p>First, upgrade to Symfony 5.4. Besides fixing all “normal” deprecations,
you also need to fix some type declarations.</p>

<p>In PHP, it is possible to define a return type when the parent
declaration doesn’t define it (yet):</p>

<div class="language-php highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">interface</span><span style="color: #BBBBBB"> UserInterface</span></span>
<span class="line" data-linenr="2"><span style="color: #999999">{</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">public</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">function</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">getRoles</span><span style="color: #999999">()</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="4"><span style="color: #999999">}</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #E5673D">class</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">User</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">implements</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">UserInterface</span></span>
<span class="line" data-linenr="7"><span style="color: #999999">{</span></span>
<span class="line" data-linenr="8"><span style="color: #999999">    </span><span style="color: #6B90C0; font-style: italic">// valid!</span></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">public</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">function</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">getRoles</span><span style="color: #999999">()</span><span style="color: #E5673D">:</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">array</span></span>
<span class="line" data-linenr="10"><span style="color: #BBBBBB">    </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="11"><span style="color: #999999">        </span><span style="color: #6B90C0; font-style: italic">// ...</span></span>
<span class="line" data-linenr="12"><span style="color: #BBBBBB">    </span><span style="color: #999999">}</span></span>
<span class="line" data-linenr="13"><span style="color: #999999">}</span></span></code></pre>
</div>

<p>At the other hand, you must define a return type if your parent does
(remember, Symfony 6 will define return types!). This means that 5.4 is
your time to add return types to all methods (especially those
overriding or implementing methods from Symfony).</p>

<p>Symfony provides a small utility in the <a href="https://symfony.com/components/ErrorHandler"><code class="highlighter-shiki">symfony/error-handler</code> component</a>
to automatically add the required return types. First, generate a
complete classmap of your application using Composer. Then, run the
utility:</p>

<div class="language-bash highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #6B90C0; font-style: italic"># (1) Make sure &quot;exclude-from-classmap&quot; is not set in your &quot;composer.json&quot;</span></span>
<span class="line" data-linenr="2"></span>
<span class="line" data-linenr="3"><span style="color: #6B90C0; font-style: italic"># (2) Generate the classmap (&quot;-o&quot; is important!)</span></span>
<span class="line" data-linenr="4"><span style="color: #BBBBBB">$ composer dump-autoload -o</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #6B90C0; font-style: italic"># (3) Run the patch script</span></span>
<span class="line" data-linenr="7"><span style="color: #BBBBBB">$ ./vendor/bin/patch-type-declarations</span></span></code></pre>
</div>

<p>Once you’ve fixed them (and running this script above will do it all for
you), you’re ready to upgrade to Symfony 6!</p>

<h3 id="when-using-symfony-6x">When using Symfony 6.x</h3>

<p>After upgrading to Symfony 6.0, you can start adding parameter types.
Parameter type compatibility is inverted compared to return types: a
child may not set the type if the parent already does, but a child
cannot set the type before the parent:</p>

<div class="language-php highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">interface</span><span style="color: #BBBBBB"> FormTypeGuesserInterface</span></span>
<span class="line" data-linenr="2"><span style="color: #999999">{</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">public</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">function</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">guessType</span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">class</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">property</span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="4"><span style="color: #999999">}</span></span>
<span class="line" data-linenr="5"></span>
<span class="line" data-linenr="6"><span style="color: #E5673D">class</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">CustomTypeGuesser</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">implements</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">UserInterface</span></span>
<span class="line" data-linenr="7"><span style="color: #999999">{</span></span>
<span class="line" data-linenr="8"><span style="color: #999999">    </span><span style="color: #6B90C0; font-style: italic">// error!</span></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">public</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">function</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">guessType</span><span style="color: #999999">(</span><span style="color: #E5673D">string</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">class</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">string</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">property</span><span style="color: #999999">)</span></span>
<span class="line" data-linenr="10"><span style="color: #BBBBBB">    </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="11"><span style="color: #999999">        </span><span style="color: #6B90C0; font-style: italic">// ...</span></span>
<span class="line" data-linenr="12"><span style="color: #BBBBBB">    </span><span style="color: #999999">}</span></span>
<span class="line" data-linenr="13"><span style="color: #999999">}</span></span></code></pre>
</div>

<p>For this reason, you cannot add these parameter types in 5.4.</p>

<h2 id="symfony-bundle-maintainers-compatibility-plan">Symfony Bundle Maintainers Compatibility Plan</h2>

<p>Unfortunately, open source maintainers can experience some more trouble
when adding return types. This is because you probably care about not
breaking backwards compatibility. And, as noted before, defining a
return type means all users overriding/implementing the method must
define it as well.</p>

<h3 id="document-the-return-type">Document the Return Type</h3>

<p>First, you can add return types only on safe methods. These are methods
that should not be extended by users of your package. The patch tool
from Symfony defines safe methods as any method that:</p>

<ul>
  <li>Is in the <code class="highlighter-shiki">Tests</code> namespace</li>
  <li>Is <code class="highlighter-shiki">final</code> or <code class="highlighter-shiki">@final</code> (or its class)</li>
  <li>Is <code class="highlighter-shiki">@internal</code> (or its class)</li>
  <li>Is <code class="highlighter-shiki">private</code></li>
</ul>

<p>Use <code class="highlighter-shiki">force=1</code> to only patch types for these safe methods:</p>

<div class="language-bash highlighter-shiki"><pre class="shiki-gutter">1
2
3
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #6B90C0; font-style: italic"># you can set the minimum PHP version, e.g. &quot;static&quot; won&#39;t be added</span></span>
<span class="line" data-linenr="2"><span style="color: #6B90C0; font-style: italic"># as a return type for 7.4</span></span>
<span class="line" data-linenr="3"><span style="color: #BBBBBB">$ SYMFONY_PATCH_TYPE_DECLARATIONS=</span><span style="color: #999999">&quot;</span><span style="color: #7CC64A">force=1&amp;php=7.4</span><span style="color: #999999">&quot;</span><span style="color: #BBBBBB"> ./vendor/bin/patch-type-declarations</span></span></code></pre>
</div>

<p>Now, you have to check if there are any methods that would produce an
error in Symfony 6. The quickest way to do this is running the same
script again. Any deprecation in the output is an incompatible method.</p>

<p>If you don’t see any deprecation: Congratulations! You are compatible with
Symfony 6 and can allow <code class="highlighter-shiki">^6.0</code> to your Symfony dependencies without having
to break compatibility for your users.</p>

<h3 id="fix-all-return-types">Fix all Return Types</h3>

<p>Some bundles may discover that they need to add return types to methods
that might be overridden or implemented. As this causes a backwards
compatibility break, you probably don’t want to do this in a minor
release.</p>

<p>Instead, make sure you properly document the correct return type using
the <code class="highlighter-shiki">@return</code> PHPDoc. This will create the useful deprecations for your
users to know they have to update their PHP return types. The patch
script can add this PHPDoc for methods that implement/override from
third party classes/interfaces:</p>

<div class="language-bash highlighter-shiki"><pre class="shiki-gutter">1
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #BBBBBB">$ SYMFONY_PATCH_TYPE_DECLARATIONS=force=phpdoc ./vendor/bin/patch-type-declarations</span></span></code></pre>
</div>

<p>After this minor release with all deprecations, you can safely add all
the missing return types in the next major version.</p>

<p>The downside of this process is that you cannot support Symfony 6 until
this major release of your own package. Make sure you keep on reading to
know how you can maybe even avoid this!</p>

<h2 id="we-need-you-to-make-everyones-life-better">We need YOU to make everyone’s life better</h2>

<p>As you can see in this post, adding return types can have quite an
impact on the community. Some return types might cause many packages to
release a new major version, potentially messing up any roadmaps or
other processes.</p>

<p>This is why we welcome you to report any return type deprecation that is
causing you to break compatibility in your package. You can do so in
<a href="https://github.com/symfony/symfony/issues/43021">this GitHub issue</a>.</p>

<p>We don’t promise anything, but based on the feedback we might postpone
some return types to Symfony 7 (to give you 2 more years to release a
new major version). We’ve already done so for some common methods found
in the Symfony bundles (e.g. <code class="highlighter-shiki">Command::execute(): int</code> and
<code class="highlighter-shiki">VoterInterface::vote(): int</code>).</p>

<h2 id="take-homes">Take Home’s</h2>

<ul>
  <li>Symfony 6 will be type safe</li>
  <li>There is a <a href="https://symfony.com/doc/5.4/setup/upgrade_major.html#upgrading-to-symfony-6-add-native-return-types"><code class="highlighter-shiki">patch-type-declarations</code> script</a> in Symfony 5.4+ that
automatically makes your code compatible</li>
  <li>Open source maintainers have 2.5 months to <a href="https://github.com/symfony/symfony/issues/43021">help us reduce the
impact</a> of this change</li>
</ul>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><category term="symfony" /><category term="pre-release" /><category term="contribute" /><summary type="html"><![CDATA[A very exciting time is coming with the biggest change for Symfony since Symfony 2.0: Symfony 6 has native PHP types on all its methods where it is possible. This will be a great push towards type safety in the PHP open source communities! Nicolas and Alexander have been working on and off for 2 years to create the best upgrade experience possible. Now, 2.5 months before the stable release, it is YOUR time to shine! Especially if you maintain any open source project (not even directly linked to Symfony), we would love to hear from you to make sure the upgrade isn’t dramatically hard.]]></summary></entry><entry><title type="html">Stabilizing Symfony: Testing out the pre-release</title><link href="https://wouterj.nl/2021/06/stabilizing-symfony-test-out-pre-releases" rel="alternate" type="text/html" title="Stabilizing Symfony: Testing out the pre-release" /><published>2021-06-17T00:00:00+00:00</published><updated>2021-06-17T00:00:00+00:00</updated><id>https://wouterj.nl/2021/06/stabilizing-symfony-test-out-pre-releases</id><content type="html" xml:base="https://wouterj.nl/2021/06/stabilizing-symfony-test-out-pre-releases"><![CDATA[<p>Symfony has a very rigid <a href="https://symfony.com/releases">release schedule</a> since Symfony 3.0.
Predictable releases are often mentioned as a major advantage. Did you
know that this schedule also includes a 2 month “stabilization phase”?
This phase gives time to all libraries and bundles to catch up. Testing
pre-releases is one of the best and least time consuming contributions
you can make to Symfony. Let’s see how you can help Symfony by reservering
30 minutes during these 2 months!</p>

<h2 id="a-quick-introduction-to-the-backwards-compatibility-promise">A quick Introduction to the Backwards Compatibility Promise</h2>

<p>It’s important to understand the <a href="https://symfony.com/bc">backwards compatibility promise</a>.
Projects used by many applications can’t simply change behavior of
features. Applications (and its developers) rely on stability of the
framework. In short, Symfony’s promise is that your application should
be able to upgrade from x.0 to x.4 <em>without any code changing efforts</em>.</p>

<aside class="side" data-type="BC Promise">
  <p>The <a href="https://symfony.com/bc">promise</a> does define some boundaries of the backwards
compatibility. For instance, if you use internal classes or an
experimental feature, there is a chance you need to make changes when
upgrading.</p>
</aside>

<p>Before releasing a new minor version (e.g. 5.3.0), the Symfony Core team
needs to make sure 2 conditions are true:</p>

<ul>
  <li>All changes to existing features are backwards compatible</li>
  <li>All new features must be stable.</li>
</ul>

<p>The last point is important: Once a feature lands in a stable release,
it’s no longer possible to change its behavior.</p>

<p>Now you know the main challenges Symfony is facing when releasing a new
minor version, let’s see how you can help!</p>

<h2 id="reporting-issues-during-stabilization">Reporting Issues during Stabilization</h2>

<p>New features are often tested in little demo applications. As we all
know, small demo applications often work much better than real life
applications. This is why bugs and backwards compatibility breaks
sometimes go completely unnoticed until real life applications start
upgrading.</p>

<p>Receiving feedback from real life applications is crucial: Symfony’s
only goal is to help you make real stuff in your daily jobs. It’s great
to receive bug reports, at all times. Yet, it’s significantly more
difficult to fix backwards compatibility breaks or bugs after a stable
release.</p>

<p>Imagine there is a backwards compatibility break (BC break) that
resulted in a PHP error. Applications that already upgraded fixed their
code to remove this error. This means that removing the BC break is also
a BC break in itself!</p>

<p>This is why testing pre-releases are critical. Pre-releases are not
covered by the BC promise. If you find a problem, we can fix the break
without yet another deprecation layer.</p>

<h2 id="how-to-test-pre-releases">How to Test Pre-Releases</h2>

<p>I hope by now, you understand the value of pre-release testing. But now,
how do you do this? Is it really just 30 minutes?</p>

<h3 id="testing-pre-releases-in-applications">Testing Pre-Releases in Applications</h3>

<p>Most people maintain Symfony applications: private projects using the
Symfony framework as a base. These projects can test pre-releases in 3
steps:</p>

<aside class="side" data-type="Quick note on stability flags">
  <p>During stabilization, Symfony releases a beta or RC (Release Candidate)
release almost on a weekly basis. Seeing the first beta release is great
indicator that Symfony has started with the stabilization phase.</p>

  <p>The RC releases are almost stable: They will probably no longer break
compatibility and the big issues are fixed.</p>

  <p>However, as bugs are continously fixed during the stabilization phase,
the dev branch is more stable than a pre-release made a couple days ago.
It’s often a great idea to use <code class="highlighter-shiki">@dev</code> instead of <code class="highlighter-shiki">@beta</code> or <code class="highlighter-shiki">@rc</code>.</p>
</aside>

<ol>
  <li>Update your <code class="highlighter-shiki">composer.json</code> to allow the next dev release. E.g.
change <code class="highlighter-shiki">5.3.*</code> to <code class="highlighter-shiki">5.4.*@dev</code> for all <code class="highlighter-shiki">symfony/*</code> packages to test
Symfony 5.4. 
Make sure to also update the <code class="highlighter-shiki">extra.symfony.require</code> key if it’s
present</li>
  <li>Add <code class="highlighter-shiki">&quot;minimum-stability&quot;: &quot;dev&quot;</code> and <code class="highlighter-shiki">&quot;prefer-stable&quot;: true</code> to your
<code class="highlighter-shiki">composer.json</code> file. This tells Composer to install dev versions,
but use stable versions for all your non-Symfony packages</li>
  <li>Update your dependencies and run your test suite</li>
</ol>

<p>Hopefully, your tests will pass. If they don’t, it means there is a BC
break or bug in the upcoming release.
In that case, you can <a href="https://symfony.com/doc/current/contributing/code/bugs.html">report a bug</a> to Symfony. It’s great
to also provide a reproducer: some code that allows everyone to
experience the bug you found. It’s hard to fix a bug if you don’t
experience it ;)</p>

<p>There is also a great benefit for you: You already tested your
application with the upcoming version. You may find yourself fixing some
deprecations on a boring Friday afternoon. Before you know it, your
applications is ready for the next release!</p>

<h3 id="testing-pre-releases-in-packages">Testing Pre-Releases in Packages</h3>

<p>Open source packages often test against multiple versions of their
dependencies (e.g. they test support for Symfony 4 and 5).</p>

<p>You can also add a “dev” version to test your package with the next
version of your dependencies. When running the dev tests, you can use
<code class="highlighter-shiki">composer config</code> to allow dev dependencies:</p>

<div class="language-bash highlighter-shiki"><pre class="shiki-gutter">1
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #BBBBBB">composer config minimum-stability dev</span></span></code></pre>
</div>

<p>This means your package now also tests against the dev dependencies.
This is a great way to see if you support upcoming versions, as well as
discovering bugs in your dependencies early. Depending on the stability
of your dependencies, it can be a good idea to allow the dev tests to
fail (e.g. using <code class="highlighter-shiki">allow_failures</code> in Travis CI).</p>

<p>I’ve used this technique in my own packages, which you can use as an
example:</p>

<ul>
  <li><a href="https://github.com/wouterj/WouterJEloquentBundle/blob/2.x/.github/workflows/tests.yml#L68-L74">GitHub Actions</a></li>
  <li><a href="https://github.com/wouterj/WouterJEloquentBundle/blob/4284b3c56c1f04bc9faf31783e702d292afc455f/.travis.yml#L37-L40">Travis CI</a></li>
</ul>

<h2 id="take-homes">Take Homes</h2>

<ul>
  <li>Contributing to Symfony doesn’t only include writing code</li>
  <li>Bugs are much more easily fixed in a pre-release</li>
  <li>Please test pre-releases (of any software) and report issues you find</li>
</ul>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><category term="symfony" /><category term="contribute" /><category term="pre-release" /><summary type="html"><![CDATA[Symfony has a very rigid release schedule since Symfony 3.0. Predictable releases are often mentioned as a major advantage. Did you know that this schedule also includes a 2 month “stabilization phase”? This phase gives time to all libraries and bundles to catch up. Testing pre-releases is one of the best and least time consuming contributions you can make to Symfony. Let’s see how you can help Symfony by reservering 30 minutes during these 2 months!]]></summary></entry><entry><title type="html">Meet the new Symfony Security: Authenticators</title><link href="https://wouterj.nl/2020/04/authenticators-new-symfony-security" rel="alternate" type="text/html" title="Meet the new Symfony Security: Authenticators" /><published>2020-04-28T00:00:00+00:00</published><updated>2020-04-28T00:00:00+00:00</updated><id>https://wouterj.nl/2020/04/authenticators-new-symfony-security</id><content type="html" xml:base="https://wouterj.nl/2020/04/authenticators-new-symfony-security"><![CDATA[<p>After more than half a year of work and discussions, Symfony 5.1 ships
with an experimental and revisited Security system. I’m incredibly
excited about this system, as I think it opens up the component for a
lot of possibilities. That’s why in the coming week, I’ll publish a
series of blogposts about this new system. I hope you’ll be just as
excited as I am and help realising the full potential with us!</p>

<aside class="side" data-type="Try it yourself!">
  <p>If you’re using Symfony 5.1, the SecurityBundle comes with all tools you
need! Set <code class="highlighter-shiki">security.enable_authenticator_manager</code> to <code class="highlighter-shiki">true</code> to enable the
new system!</p>

  <p>Please be aware that this new system in experimental. It may contain
backwards compatibility breaks in 5.2. However, I don’t like to ruin the
life of early-testers so we keep this to the bare minimum. Please give it
a go and report any suggestions, problems, bugs, leaks or whatever!</p>
</aside>

<p>So… what is so different about this new system? It would like to
summarize it in three topics:</p>

<ul>
  <li><a href="#removed-everything-but-guards">It removes everything but Guard</a></li>
  <li><a href="#moved-to-an-event-based-system">It refactored to an event-based System</a></li>
  <li><a href="#the-next-generation-of-guards">It introduces the next generation of Guards</a></li>
</ul>

<h2 id="removed-everything-but-guards">Removed everything but Guards</h2>

<p>Since Symfony 2.0, the authentication system of Symfony can be drawn
like this:</p>

<p><img src="/img/security2-providers-listeners.png" alt="Symfony Security" /></p>

<p>This diagram has set-up 2 firewalls (yellow and red). The yellow
firewall has 2 different ways to authenticate (e.g. login form and json
login) and the red firewall has one way to authenticate (e.g. JWT).</p>

<p>A <em>firewall listener</em> extracts all necessary information from the
request (e.g. username, password, csrf token). This is passed into a
global <em>authentication manager</em>, which then calls the required
<em>authentication provider</em> (e.g. one that can authenticate a username and
password).</p>

<p>If you were to write your own custom authentication, you would most
likely need to provide a custom <em>listener</em>. This listener needs to do
all stuff: calling the manager, storing the authenticated token, setting
up the session (e.g. migrating it) and creating a correct response. It’s
very easy to forget a step, resulting in a less secure or broken
authentication. Hence, if you look at Symfony’s own firewall listeners,
you can find minor inconsistencies as well.</p>

<p>The new authenticator system can be drawn like this:</p>

<p><img src="/img/security2-authenticators.png" alt="Symfony Authenticators" /></p>

<ol>
  <li>There is <em>only one</em> listener, provided by Symfony, that passes the
request into an authenticator manager</li>
  <li>There is <em>one</em> authenticator manager per firewall. This manager calls
the correct authenticator, which authenticates the request and
returns a response</li>
</ol>

<p>You now only need to write a custom authenticator. The authenticator
manager (maintained by Symfony) takes care of session management,
storing the token, remember me functionality, etc. So there are less
things to forget!</p>

<p>This may appear to be similar to Guards in the current system… It is!
However, the internal logics of the component was still using the
listeners and providers. This new system makes them all use exactly the
same interface: Authenticators. This makes it easier to understand and
contribute to the Security component.</p>

<p>As there now is one authenticator manager per firewall, the manager
knows how to authenticate a request and return a success response. <strong>This
also allowed us to add programmatic login to Symfony</strong>: The manager is
now finally able to authenticate a User object and return a success
response.</p>

<h2 id="moved-to-an-event-based-system">Moved to an Event-based System</h2>

<p>Symfony’s HttpKernel component is built around
<a href="https://symfony.com/doc/current/components/http_kernel.html#httpkernel-driven-by-events">5 kernel events</a>.
Listeners to these events execute the core process of Symfony: finding a
controller, executing that controller and handling the response. You can
also create your own event listeners on these events, so you can
completely customize and extend this core process.</p>

<aside class="side" data-type="Here's how you can help">
  <p>I can imagine Symfony providing a <em>login throttling listener</em>, which
blocks login for a couple of minutes after too many failed attempts.</p>

  <p>Or e.g. a monolog logger to log failed attempts (such that you can
analyse them and block misbehaving IPs or the like).</p>

  <p>You can probably come up with even better ideas of listeners! Please
contribute them to Symfony.</p>
</aside>

<p>Up to now, the Security component didn’t use events for this purpose.
This made many parts of the component quite hard to extend or customize.
That’s why this new system is built around 3 main events:</p>

<dl>
  <dt><code class="highlighter-shiki">VerifyAuthenticatorCredentialsEvent</code></dt>
  <dd>This is the most important event. Its listeners validate any
credentials returned from the authenticator (e.g. a password or CSRF
token).</dd>
  <dt><code class="highlighter-shiki">LoginSuccessEvent</code></dt>
  <dd>If all credentials were valid, this event is dispatched. The core
system uses this to e.g. create a remember me cookie or upgrade the
password hash.</dd>
  <dt><code class="highlighter-shiki">LoginFailureEvent</code></dt>
  <dd>If there was an error or credentials are not correct, this event is
dispatched.</dd>
</dl>

<p>All core logic is now executed as listener on these events. E.g. if an
authenticator requires a password to be validated, a listener on
<code class="highlighter-shiki">VerifyAuthenticatorCredentialsEvent</code> will do this for you. Things like
user checkers, session strategies, remember me cookies, password
upgrading are all done inside event listeners.</p>

<h2 id="the-next-generation-of-guards">The Next Generation of Guards</h2>

<aside class="side" data-type="Here's how you can help">
  <p>It would be lovely to have many more modern authenticators inside
Symfony core:</p>

  <ul>
    <li>Third-party/redirections: SAML, OAuth, …</li>
    <li>API tokens: JWT, JOSE, PASETO, Windows Identity Foundation, …</li>
    <li>“Magic links” sent via Notifier component</li>
  </ul>
</aside>

<p>A few years ago,
<a href="https://symfonycasts.com/blog/guard-authentication">Guards</a> where
introduced to provide a better extension point for Security. The new
system started with this exact Guard interface as a base. The event
based logic introduced a centralized credentials checking. This removed
the need for a <code class="highlighter-shiki">checkCredentials()</code> method in the Guard interface. Later
on, we introduced some more changes to the interface: The next generation
<code class="highlighter-shiki">AuthenticatorInterface</code> was born!</p>

<p>The big change from the Guard interface you may know is that
<code class="highlighter-shiki">getCredentials()</code> and <code class="highlighter-shiki">getUser()</code> are merged into one method:
<code class="highlighter-shiki">authenticate(Request $request)</code>. And, as mentioned before,
<code class="highlighter-shiki">checkCredentials()</code> is gone.</p>

<p>This new <code class="highlighter-shiki">authenticate()</code> method creates a <em>Security Passport</em>. This is
a new concept in authenticators. <strong>A passport contains the user and any
credentials needed to authenticate.</strong> This extra information is provided
using <em>Passport Badges</em>. Listeners on the
<code class="highlighter-shiki">VerifyAuthenticatorCredentialsEvent</code> will validate and check the
passport and all its badges. If <em>all</em> badges are resolved, the user is
succesfully authenticated.</p>

<p>Let’s see the passport in action. Assume we’re building a form login:</p>

<div class="language-php highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #6B90C0; font-style: italic">// ...</span></span>
<span class="line" data-linenr="2"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">HttpFoundation</span><span style="color: #999999">\</span><span style="color: #C7C8D2">Request</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="3"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Security</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Core</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Exception</span><span style="color: #999999">\</span><span style="color: #C7C8D2">UsernameNotFoundException</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="4"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Security</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Http</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Authenticator</span><span style="color: #999999">\</span><span style="color: #C7C8D2">AuthenticatorInterface</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="5"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Security</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Http</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Authenticator</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Passport</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Badge</span><span style="color: #999999">\</span><span style="color: #C7C8D2">CsrfTokenBadge</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="6"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Security</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Http</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Authenticator</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Passport</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Credentials</span><span style="color: #999999">\</span><span style="color: #C7C8D2">PasswordCredentials</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="7"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Security</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Http</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Authenticator</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Passport</span><span style="color: #999999">\</span><span style="color: #C7C8D2">Passport</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="8"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Security</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Http</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Authenticator</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Passport</span><span style="color: #999999">\</span><span style="color: #C7C8D2">PassportInterface</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="9"></span>
<span class="line" data-linenr="10"><span style="color: #E5673D">class</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">FormAuthenticator</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">implements</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">AuthenticatorInterface</span></span>
<span class="line" data-linenr="11"><span style="color: #999999">{</span></span>
<span class="line" data-linenr="12"><span style="color: #999999">    </span><span style="color: #6B90C0; font-style: italic">// ...</span></span>
<span class="line" data-linenr="13"></span>
<span class="line" data-linenr="14"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">public</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">function</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">authenticate</span><span style="color: #999999">(</span><span style="color: #C7C8D2">Request</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">request</span><span style="color: #999999">)</span><span style="color: #E5673D">:</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">PassportInterface</span></span>
<span class="line" data-linenr="15"><span style="color: #BBBBBB">    </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="16"><span style="color: #999999">        </span><span style="color: #6B90C0; font-style: italic">// find a user based on an &quot;email&quot; form field</span></span>
<span class="line" data-linenr="17"><span style="color: #BBBBBB">        </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">user</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">this</span><span style="color: #E5673D">-&gt;</span><span style="color: #D8DEE9">userRepository</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">findOneByEmail</span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">request</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">get</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">email</span><span style="color: #999999">&#39;</span><span style="color: #999999">))</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="18"><span style="color: #BBBBBB">        </span><span style="color: #E5673D">if</span><span style="color: #BBBBBB"> </span><span style="color: #999999">(</span><span style="color: #E5673D">!$</span><span style="color: #D8DEE9">user</span><span style="color: #999999">)</span><span style="color: #BBBBBB"> </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="19"><span style="color: #BBBBBB">            </span><span style="color: #E5673D">throw</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">UsernameNotFoundException</span><span style="color: #999999">()</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="20"><span style="color: #BBBBBB">        </span><span style="color: #999999">}</span></span>
<span class="line" data-linenr="21"></span>
<span class="line" data-linenr="22"><span style="color: #999999">        </span><span style="color: #6B90C0; font-style: italic">// return the Security passport</span></span>
<span class="line" data-linenr="23"><span style="color: #BBBBBB">        </span><span style="color: #E5673D">return</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">Passport</span><span style="color: #999999">(</span></span>
<span class="line" data-linenr="24"><span style="color: #999999">            </span><span style="color: #6B90C0; font-style: italic">// add the user we&#39;ve just found</span></span>
<span class="line" data-linenr="25"><span style="color: #BBBBBB">            </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">user</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="26"><span style="color: #999999">            </span><span style="color: #6B90C0; font-style: italic">// add credentials from the &quot;password&quot; form field</span></span>
<span class="line" data-linenr="27"><span style="color: #BBBBBB">            </span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">PasswordCredentials</span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">request</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">get</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">password</span><span style="color: #999999">&#39;</span><span style="color: #999999">)),</span></span>
<span class="line" data-linenr="28"><span style="color: #BBBBBB">            </span><span style="color: #999999">[</span></span>
<span class="line" data-linenr="29"><span style="color: #999999">                </span><span style="color: #6B90C0; font-style: italic">// and CSRF protection using a &quot;csrf_token&quot; field</span></span>
<span class="line" data-linenr="30"><span style="color: #BBBBBB">                </span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">CsrfTokenBadge</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">loginform</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">request</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">get</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">csrf_token</span><span style="color: #999999">&#39;</span><span style="color: #999999">))</span></span>
<span class="line" data-linenr="31"></span>
<span class="line" data-linenr="32"><span style="color: #999999">                </span><span style="color: #6B90C0; font-style: italic">// and add support for upgrading the password hash</span></span>
<span class="line" data-linenr="33"><span style="color: #BBBBBB">                </span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">PasswordUpgradeBadge</span><span style="color: #999999">(</span></span>
<span class="line" data-linenr="34"><span style="color: #BBBBBB">                    </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">request</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">get</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">password</span><span style="color: #999999">&#39;</span><span style="color: #999999">),</span></span>
<span class="line" data-linenr="35"><span style="color: #BBBBBB">                    </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">this</span><span style="color: #E5673D">-&gt;</span><span style="color: #D8DEE9">userRepository</span></span>
<span class="line" data-linenr="36"><span style="color: #BBBBBB">                </span><span style="color: #999999">)</span></span>
<span class="line" data-linenr="37"><span style="color: #BBBBBB">            </span><span style="color: #999999">]</span></span>
<span class="line" data-linenr="38"><span style="color: #BBBBBB">        </span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="39"><span style="color: #BBBBBB">    </span><span style="color: #999999">}</span></span>
<span class="line" data-linenr="40"><span style="color: #999999">}</span></span></code></pre>
</div>

<aside class="side" data-type="Here's how you can help">
  <p>I’ve talked before on <a href="/2019/03/security-removing-user">removing the User object from Security</a>.
The main passport interface does not require a user. I invite anyone to
build a system that works without user and submit it to Symfony.</p>
</aside>

<p>This gives an authenticator all power about what is needed for
successful authentication. At the same time, the most important piece is
handled centralized in an event listener. This makes applications less
vunerable, as security leaks will be fixed by the Symfony Security
team. You can also write your own listener to resolve a badge before a
listener of Symfony, to customize the checks.</p>

<p>There also is a <code class="highlighter-shiki">CustomCredentials</code> class that you can use to call a
custom method to check credentials and a <code class="highlighter-shiki">SelfCheckingPassport</code> in case
you don’t need Symfony to check any credentials (e.g. when using API tokens).</p>

<h2 id="next-up">Next up</h2>

<p>I plan to write at least two more blogposts about the new system in the
coming weeks. We’ll write real code for a real custom logins on both of these:</p>

<ul>
  <li>Writing a custom authenticator: Passwords &amp; Badges</li>
  <li>Customizing security using event listeners</li>
</ul>]]></content><author><name>Wouter de Jong</name></author><category term="article" /><category term="symfony" /><category term="security" /><summary type="html"><![CDATA[After more than half a year of work and discussions, Symfony 5.1 ships with an experimental and revisited Security system. I’m incredibly excited about this system, as I think it opens up the component for a lot of possibilities. That’s why in the coming week, I’ll publish a series of blogposts about this new system. I hope you’ll be just as excited as I am and help realising the full potential with us!]]></summary></entry><entry><title type="html">Learn to Write more Concise</title><link href="https://wouterj.nl/2020/02/learn-to-write-more-concise" rel="alternate" type="text/html" title="Learn to Write more Concise" /><published>2020-02-10T00:00:00+00:00</published><updated>2020-02-10T00:00:00+00:00</updated><id>https://wouterj.nl/2020/02/learn-to-write-more-concise</id><content type="html" xml:base="https://wouterj.nl/2020/02/learn-to-write-more-concise"><![CDATA[<p>Ernest Hemingway is a writer from the twentieth-century know for his
short and declarative writing style. Hemingwayapp.com is a free online
tool that analyses your text according to this style. It also runs the
Automated Readability Index algorithm. This makes it a perfect tool to
write concise, short and easy to understand texts.</p>

<article class="external">
  <p><img src="/img/hemingway-app-screenshot.png" class="external__hero" /></p>

  <h3 class="external__target"><a href="http://www.hemingwayapp.com/">http://www.hemingwayapp.com</a></h3>

  <p class="external__description">Hemingway makes your writing bold and clear. It’s like a
  spellchecker, but for style. It makes sure that your reader will focus
  on your message, not your prose.

  Too often, our words are like our thoughts — innumerable and
  disorganized. Almost any bit of writing could use some cutting. Less
  is more, etc.</p>
</article>

<p>I almost always copy-paste my writings into the tool to check and
revisit some redundant parts and too long sentences. An average adult
reads around the 10th grade. All development language often doesn’t have
a good influence on your grade, but at least you are aware of the
difficulty of your text.</p>]]></content><author><name>Wouter de Jong</name></author><category term="link" /><category term="symfony" /><category term="security" /><summary type="html"><![CDATA[Ernest Hemingway is a writer from the twentieth-century know for his short and declarative writing style. Hemingwayapp.com is a free online tool that analyses your text according to this style. It also runs the Automated Readability Index algorithm. This makes it a perfect tool to write concise, short and easy to understand texts.]]></summary></entry></feed>